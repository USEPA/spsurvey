---
title: "Start Here"
author: "Michael Dumelle, Tony Olsen, Tom Kincaid, and Marc Weber"
output: 
  html_document:
    theme: flatly
    number_sections: true
    highlighted: default 
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: no
    toc_depth: 2
vignette: >
  %\VignetteIndexEntry{Start Here}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  warning = FALSE, 
  message = FALSE
)
```

# Installing and Loading spsurvey

If this is your first time using the spsurvey package, run
```{r, eval = FALSE}
install.packages("spsurvey")
```
to install the package. You only need to run this code once per version of R.

After the spsurvey package is installed, load it into R each new R session by running
```{r setup}
library(spsurvey)
```

# Vignettes in spsurvey

There are three additional vignettes in spsurvey:

1. Summarizing and Visualizing Data: Use the `summary()` and `plot()` functions to summarize and visualize sample frames, samples, and design frames. To view this vignette, run `vignette("EDA", "spsurvey")` (EDA is short for exploratory data analysis).
2. Spatially Balanced Probability Samples: Use the `grts()` function to implement the Generalized Random Tessellation Stratified (GRTS) algorithm (Stevens and Olsen, 2004) to select spatially balanced samples. To view this vignette, run `vignette("sampling", "spsurvey")`.
3. Analyzing Probability Samples: Use several analysis functions to analyze data. To view this vignette, run `vignette("analysis", "spsurvey")`.

These vignettes cover some of the core functions (and arguments within those functions) in spsurvey. To learn more about features of spsurvey that are not covered in these vignettes, we encourage you to read spsurvey's documentation. Interactive help files for a particular function are available by running `?function_name` after loading spsurvey. For example, to learn more about the `grts()` function, run `?grts`.

# Installing a Previous Version of spsurvey

The spsurvey version 5.0 update implemented many significant changes to existing functions. As a result, some of your old code may not run properly while using version 5.0. Though we recommend adapting your code to work with the version 5.0, you may also install a previous version of spsurvey. For information regarding the installation of previous version of R packages, please see the RStudio support page [here](https://support.rstudio.com/hc/en-us/articles/219949047-Installing-older-versions-of-packages). Additionally, old versions of spsurvey are also available for download in the release tags section of our GitHub repository [here](https://github.com/USEPA/spsurvey/releases).

# `sf` Objects

The sampling functions in spsurvey require your data is an `sf` object. An `sf` object, shorthand for a "simple features" object, is an R object with a unique structure used to conveniently store spatial data. `sf` objects are constructed using the sf package (Pebesma, 2018). The sf package is loaded and installed alongside the spsurvey package, so you do not need to run `install.packages("sf")` or `library(sf)` to access the sf package if spsurvey is already installed and loaded. For more on the sf package, see [here](https://r-spatial.github.io/sf/index.html).

Next we discuss three ways to construct sf objects in R. The first is to read a shapefile directly into R using `st_read()` or `read_sf()`. The second is to use the `st_sf()` function or the `st_as_sf()` function to combine an appropriate R object (most commonly a data frame) and an appropriate geometry object into an `sf` object. The third only applies if your data is an `sp` object --  you can use the `sframe()` function in spsurvey to convert your `sp` object to an `sf` object. For more information regarding `sf` objects, see Pebesma (2018) and Lovelace et al. (2019). 

# Coordinate Reference Systems

Spatial data and `sf` objects rely on coordinate reference systems. A coordinate reference system (CRS) provides a structure by which to identify unique locations on the Earth's surface. CRSs are either geographic or projected. A geographic CRS uses longitude (east-west direction) and latitude (north-south direction) coordinates to represent location with respect to a specific ellipsoid or spheroid surface. Geographic CRSs are measured in degrees, *not units like meters or feet* -- this has important consequence. For example, a one degree difference in latitude is different at different longitudes. Projected CRSs are measured in standard Cartesian coordinates with respect to a flat surface. They have x and y locations, an origin, and a unit of measurement (like meters or feet). 

CRSs in R have traditionally been stored using EPSG codes or `proj4string` values. This meant that in order to transform your coordinates from one CRS to another, you needed two EPSG codes or `proj4string` values, one for each CRS. Recent updates to R's handling of spatial data follow GDAL and PROJ (more information available [here](https://www.r-spatial.org/r/2020/03/17/wkt.html)), and CRSs in `sf` objects are stored in R as lists with two components: `input`, which contains information regarding the EPSG code and proj4string; and `wkt`, an open geospatial standard format. For more information on CRSs and EPSG codes, see Pebesma (2018) and Lovelace et al. (2019). To search for various coordinate reference systems and EPSG codes, see [here](https://spatialreference.org) and [here](https://epsg.io/).

spsurvey will use the coordinates from your `sf` object, so it is your responsibility to make sure the `sf` object has an appropriate CRS. If the CRS is not specified correctly, you may get misleading results.

# References

Lovelace, R., Nowosad, J., & Muenchow, J. (2019). Geocomputation with R. CRC Press.

Pebesma, E., (2018). Simple Features for R: Standardized Support for Spatial Vector Data. *The R Journal*, 10 (1):439-446. https://doi.org/10.32614/RJ-2018-009

Stevens Jr, D. L. and Olsen, A. R. (2004). Spatially balanced sampling of natural resources. *Journal of the American Statistical Association*, 99(465):262-278.
